name: Telegram Bot Manual Runner

on:
  # Loại bỏ hoàn toàn schedule để không tự chạy vào 6h sáng
  workflow_dispatch: # Giữ lại nút "Run workflow" để bạn bấm chạy thủ công

jobs:
  run-bot:
    runs-on: ubuntu-latest
    # Cấu hình GitHub tự động ngắt job sau 120 phút (2 tiếng)
    timeout-minutes: 120
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: pip install pyTelegramBotAPI gspread oauth2client pytz

      - name: Run Bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          G_SHEETS_JSON: ${{ secrets.G_SHEETS_JSON }}
          TZ: "Asia/Ho_Chi_Minh"
          # Chúng ta không cần lệnh "timeout 21600s" ở đây nữa 
          # vì "timeout-minutes" ở phía trên đã quản lý việc này.
        run: python bot.py || echo "Đã hết 2 giờ làm việc, bot tự động nghỉ."
